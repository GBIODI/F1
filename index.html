<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¬øA Qui√©n Elijo? - F1 Edition</title>
    
    <!-- Carga de Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Carga de la fuente Inter --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ... (Estilos CSS sin cambios) ... */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
        }
        .character-card {
            perspective: 1000px;
            cursor: pointer;
        }
        .card-inner {
            position: relative;
            width: 100%;
            aspect-ratio: 1 / 1; 
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .character-card.is-flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-front,
        .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        .card-back {
            transform: rotateY(180deg);
        }
        #mystery-card-container {
            aspect-ratio: 1 / 1;
        }
        /* Estilo para el dropdown deshabilitado */
        select:disabled {
            background-color: #4B5563; /* bg-gray-600 */
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        /* --- NUEVO ESTILO PARA EL MODAL --- */
        /* Fondo oscuro del modal */
        #game-modal-overlay {
            transition: opacity 0.3s ease;
        }
        /* Contenedor del modal */
        #game-modal-content {
            transition: all 0.3s ease;
            transform: translateY(-20px);
        }
        #game-modal.hidden #game-modal-content {
            transform: translateY(0px);
        }
        
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-4 sm:p-8">

    <header class="max-w-7xl mx-auto mb-6">
        <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
            <h1 class="text-3xl sm:text-4xl font-bold text-center text-blue-300">
                ¬øA Qui√©n Elijo? - F1 Edition
            </h1>
            
            <div class="flex gap-2">
                <!-- NUEVO BOT√ìN DE ADIVINAR --><button id="guess-button" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-colors duration-300">
                    Adivinar Piloto
                </button>
                
                <!-- Bot√≥n de Reinicio --><button id="reset-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-colors duration-300">
                    Reiniciar Juego
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto flex flex-col md:flex-row gap-6">
        
        <!-- Secci√≥n del Tablero de Juego --><section class="w-full md:w-3/4">
            
            <!-- Cuadr√≠cula del tablero (4 columnas en escritorio, 2 en m√≥vil) --><div id="game-board" class="grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-5">
                <!-- Las cartas se generar√°n aqu√≠ por JavaScript --></div>
        </section>

        <!-- Panel Lateral para el Personaje Secreto --><aside class="w-full md:w-1/4">
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg sticky top-8">
                <h2 class="text-2xl font-bold text-blue-300 mb-4">Mi Piloto</h2>
                <div class="space-y-4">
                    <label for="character-select" class="block text-sm font-medium text-gray-300">Elige tu piloto secreto:</label>
                    
                    <!-- Men√∫ desplegable de selecci√≥n --><select id="character-select" class="w-full bg-gray-700 border border-gray-600 text-white rounded-lg p-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-300">
                        <option value="">-- Elige un piloto --</option>
                        <!-- Las opciones se generar√°n aqu√≠ por JavaScript --></select>
                    
                    <!-- BOT√ìN DE CONFIRMAR --><button id="lock-button" class="hidden w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-300">
                        Confirmar Piloto
                    </button>
                    
                    <!-- Contenedor de la imagen secreta --><div id="mystery-card-container" class="bg-gray-700 rounded-lg flex items-center justify-center overflow-hidden border-4 border-gray-600">
                        <!-- Placeholder 1:1 --><img id="mystery-card-image" src="https://placehold.co/300x300/4B5563/9CA3AF?text=?" alt="Piloto misterioso" class="w-full h-full object-cover transition-opacity duration-300">
                    </div>
                </div>
            </div>
        </aside>

    </main>

    <!-- --- NUEVO MODAL DE VICTORIA/DERROTA --- -->
    <div id="game-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <!-- Fondo oscuro -->
        <div id="game-modal-overlay" class="absolute inset-0 bg-black bg-opacity-75"></div>
        
        <!-- Contenido del modal -->
        <div id="game-modal-content" class="relative bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6">
            <!-- Texto del mensaje (se llenar√° con JS) -->
            <p id="game-modal-text" class="text-white text-lg text-center mb-6">
                Este es un mensaje de prueba.
            </p>
            
            <!-- Bot√≥n de cerrar -->
            <button id="game-modal-close" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">
                Entendido
            </button>
        </div>
    </div>


    <script>
        // Objeto con los personajes y sus URLs (APUNTANDO A LA CARPETA LOCAL 'imagenes/')
        const characters = [
            // Fila 1
            { name: "Oscar Piastri", imageUrl: "imagenes/Piastri.png" },
            { name: "Lando Norris", imageUrl: "imagenes/Norris.png" },
            { name: "Charles Leclerc", imageUrl: "imagenes/Leclerc.png" },
            { name: "Lewis Hamilton", imageUrl: "imagenes/Hamilton.png" },
            // Fila 2
            { name: "George Russell", imageUrl: "imagenes/Russell.png" },
            { name: "Kimi Antonelli", imageUrl: "imagenes/Antonelli.png" },
            { name: "Max Verstappen", imageUrl: "imagenes/Verstappen.png" },
            { name: "Yuki Tsunoda", imageUrl: "imagenes/Tsunoda.png" },
            // Fila 3
            { name: "Alexander Albon", imageUrl: "imagenes/Albon.png" },
            { name: "Carlos Sainz", imageUrl: "imagenes/Sainz.png" },
            { name: "Liam Lawson", imageUrl: "imagenes/Lawson.png" },
            { name: "Isack Hadjar", imageUrl: "imagenes/Hadjar.png" },
            // Fila 4
            { name: "Lance Stroll", imageUrl: "imagenes/Stroll.png" },
            { name: "Fernando Alonso", imageUrl: "imagenes/Alonso.png" },
            { name: "Esteban Ocon", imageUrl: "imagenes/Ocon.png" },
            { name: "Oliver Bearman", imageUrl: "imagenes/Bearman.png" },
            // Fila 5
            { name: "Nico Hulkenberg", imageUrl: "imagenes/Hulkenberg.png" },
            { name: "Gabriel Bortoleto", imageUrl: "imagenes/Bortoleto.png" },
            { name: "Pierre Gasly", imageUrl: "imagenes/Gasly.png" },
            { name: "Franco Colapinto", imageUrl: "imagenes/Colapinto.png" }
        ];

        // Se ejecuta cuando el contenido del HTML est√° cargado
        document.addEventListener('DOMContentLoaded', () => {
            const gameBoard = document.getElementById('game-board');
            const resetButton = document.getElementById('reset-button');
            const characterSelect = document.getElementById('character-select');
            const mysteryCardImage = document.getElementById('mystery-card-image');
            const lockButton = document.getElementById('lock-button');
            
            // --- NUEVOS ELEMENTOS ---
            const guessButton = document.getElementById('guess-button');
            const gameModal = document.getElementById('game-modal');
            const modalText = document.getElementById('game-modal-text');
            const closeModalButton = document.getElementById('game-modal-close');
            
            // --- L√çNEA CORREGIDA ---
            const gameModalOverlay = document.getElementById('game-modal-overlay'); // Se a√±ade la definici√≥n
            
            // Placeholder 1:1
            const placeholderImage = "https://placehold.co/300x300/4B5563/9CA3AF?text=Selecciona+un+piloto"; 
            // URL del logo de F1 (APUNTANDO A LA CARPETA LOCAL 'imagenes/')
            const f1LogoBack = "imagenes/logo-f1.png"; 

            // Funci√≥n para crear el tablero (sin cambios)
            function createBoard() {
                gameBoard.innerHTML = ''; 
                characters.forEach(character => {
                    const card = document.createElement('div');
                    card.className = 'character-card';
                    card.setAttribute('role', 'button');
                    // IMPORTANTE: El 'aria-label' se usa para la l√≥gica de victoria
                    card.setAttribute('aria-label', `Carta de ${character.name}`);
                    const cardInner = document.createElement('div');
                    cardInner.className = 'card-inner';
                    const cardFront = document.createElement('div');
                    cardFront.className = 'card-front bg-white border-4 border-gray-300 rounded-lg shadow-lg';
                    const img = document.createElement('img');
                    img.src = character.imageUrl;
                    img.alt = `Imagen de ${character.name}`;
                    img.className = 'w-full h-full object-cover';
                    cardFront.appendChild(img);
                    const cardBack = document.createElement('div');
                    cardBack.className = 'card-back border-4 border-red-900 rounded-lg shadow-lg flex items-center justify-center';
                    const f1LogoImg = document.createElement('img');
                    f1LogoImg.src = f1LogoBack;
                    f1LogoImg.alt = "Logo F1";
                    f1LogoImg.className = 'w-full h-full object-cover'; 
                    cardBack.appendChild(f1LogoImg);
                    cardInner.appendChild(cardFront);
                    cardInner.appendChild(cardBack);
                    card.appendChild(cardInner);
                    card.addEventListener('click', () => {
                        card.classList.toggle('is-flipped');
                    });
                    gameBoard.appendChild(card);
                });
            }

            // --- FUNCI√ìN RESETGAME (ACTUALIZADA) ---
            function resetGame() {
                const flippedCards = document.querySelectorAll('.character-card.is-flipped');
                flippedCards.forEach(card => {
                    card.classList.remove('is-flipped');
                });

                characterSelect.value = ""; 
                mysteryCardImage.src = placeholderImage;
                mysteryCardImage.alt = "Piloto misterioso";
                
                characterSelect.disabled = false; // Habilita el dropdown
                lockButton.classList.add('hidden'); // Oculta el bot√≥n de confirmar
                
                // --- NUEVA L√çNEA ---
                gameModal.classList.add('hidden'); // Oculta el modal
            }

            // Funci√≥n para llenar el men√∫ desplegable (sin cambios)
            function populateSelect() {
                characterSelect.innerHTML = '<option value="">-- Elige un piloto --</option>'; 
                characters.forEach(character => {
                    const option = document.createElement('option');
                    option.value = character.name;
                    option.textContent = character.name;
                    characterSelect.appendChild(option);
                });
            }

            // Funci√≥n para manejar la selecci√≥n de personaje (sin cambios)
            function handleCharacterSelect(event) {
                const selectedName = event.target.value;

                if (selectedName === "") {
                    mysteryCardImage.src = placeholderImage;
                    mysteryCardImage.alt = "Piloto misterioso";
                    lockButton.classList.add('hidden'); 
                    return;
                }

                const selectedCharacter = characters.find(char => char.name === selectedName);
                
                if (selectedCharacter) {
                    mysteryCardImage.src = selectedCharacter.imageUrl;
                    mysteryCardImage.alt = `Piloto elegido: ${selectedCharacter.name}`;
                    lockButton.classList.remove('hidden'); 
                }
            }
            
            // Funci√≥n para bloquear la elecci√≥n (sin cambios)
            function lockChoice() {
                characterSelect.disabled = true; 
                lockButton.classList.add('hidden'); 
            }
            
            // --- NUEVA FUNCI√ìN ---
            // Muestra el modal con un texto espec√≠fico
            function showModal(text) {
                modalText.innerHTML = text; // Usamos innerHTML para permitir saltos de l√≠nea con <br>
                gameModal.classList.remove('hidden');
            }
            
            // --- NUEVA FUNCI√ìN ---
            // L√≥gica para comprobar si se ha ganado
            function checkWin() {
                const secretName = characterSelect.value;
                
                // 1. Comprobar si se ha confirmado un piloto
                if (characterSelect.disabled === false || secretName === "") {
                    showModal("Debes elegir y confirmar tu piloto secreto antes de adivinar.");
                    return;
                }
                
                // 2. Comprobar cu√°ntas cartas quedan boca arriba
                const faceUpCards = document.querySelectorAll('.character-card:not(.is-flipped)');
                
                if (faceUpCards.length !== 1) {
                    showModal("¬°A√∫n no! Debes dejar exactamente UN piloto boca arriba para poder adivinar.");
                    return;
                }
                
                // 3. Hay exactamente 1 carta. Comprobar si es la correcta.
                const guessName = faceUpCards[0].getAttribute('aria-label').replace('Carta de ', '');
                
                if (guessName === secretName) {
                    showModal(`¬°GANASTE! ü•≥<br><br>Adivinaste correctamente. El piloto era <strong>${secretName}</strong>.`);
                } else {
                    showModal(`¬°Oh no! Perdiste.<br><br>Dejaste a <strong>${guessName}</strong>, pero tu piloto secreto era <strong>${secretName}</strong>.`);
                }
            }

            // Asignar eventos
            resetButton.addEventListener('click', resetGame);
            characterSelect.addEventListener('change', handleCharacterSelect);
            lockButton.addEventListener('click', lockChoice);
            
            // --- NUEVOS EVENTOS ---
            guessButton.addEventListener('click', checkWin);
            closeModalButton.addEventListener('click', () => gameModal.classList.add('hidden'));
            gameModalOverlay.addEventListener('click', () => gameModal.classList.add('hidden'));


            // Inicializar el juego
            createBoard();
            populateSelect(); 
        });
    </script>
    <!-- üî• Firebase + Firestore -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

  // Configuraci√≥n de tu proyecto
  const firebaseConfig = {
    apiKey: "AIzaSyAvbzdUY9CokU9Rh-OJkZf7SF3Nxvu5QNk",
    authDomain: "f1-juego.firebaseapp.com",
    projectId: "f1-juego",
    storageBucket: "f1-juego.firebasestorage.app",
    messagingSenderId: "401612401240",
    appId: "1:401612401240:web:f1ad0dee715c45fead782d",
    measurementId: "G-M4Q3GCHKY8"
  };

  // Inicializa Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  console.log("‚úÖ Firebase y Firestore inicializados correctamente.");

  // üì§ Guarda una prueba al abrir la p√°gina
  async function guardarPrueba() {
    try {
      await addDoc(collection(db, "partidas"), {
        jugador: "Ruso",
        puntos: 10,
        fecha: new Date()
      });
      console.log("üéØ Datos guardados correctamente en Firestore.");
    } catch (e) {
      console.error("‚ùå Error al guardar:", e);
    }
  }

  guardarPrueba();
</script>
</body>
</html>
